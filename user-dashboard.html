<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
    header { background:#d40000; color:white; padding:15px; text-align:center; }
    .profile { display:flex; align-items:center; gap:10px; justify-content:center; }
    .profile img { width:50px; height:50px; border-radius:50%; object-fit:cover; }
    .container { padding:20px; }
    .balance { font-size:22px; margin:20px 0; }
    .actions button { margin:5px; padding:10px 15px; border:none; border-radius:5px; cursor:pointer; background:#d40000; color:white; }
    .history { margin-top:20px; }
    .history h3 { margin-bottom:10px; }
    .history ul { list-style:none; padding:0; }
    .history li { background:white; padding:10px; margin-bottom:5px; border-radius:5px; }
    .popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
    .popup-content { background:white; padding:20px; border-radius:10px; width:300px; }
    .popup-content input, .popup-content textarea { width:100%; margin:10px 0; padding:8px; }
    .popup-content button { margin-top:10px; width:100%; background:#d40000; color:white; border:none; padding:10px; cursor:pointer; border-radius:5px; }
    .announcement { background:yellow; color:black; padding:10px; text-align:center; margin:10px 0; border-radius:5px; }
    .suspended { background:red; color:white; padding:20px; text-align:center; font-size:20px; border-radius:10px; margin:20px 0; }
  </style>
</head>
<body>

<header>
  <div class="profile">
    <img id="userImage" src="https://via.placeholder.com/50" alt="Profile">
    <h2 id="username">User Dashboard</h2>
  </div>
</header>

<div class="container" id="dashboardContent">
  <div id="announcementBox"></div>
  <div id="suspendedBox"></div>

  <div class="balance">
    Balance: <span id="balance">$0.00</span>
  </div>

  <div class="actions" id="actionsBox">
    <button onclick="openPopup('withdraw')">Withdraw</button>
    <button onclick="openPopup('transfer')">International Transfer</button>
    <button onclick="openPopup('loan')">Request Loan</button>
  </div>

  <div class="history">
    <h3>Transaction History</h3>
    <ul id="historyList"></ul>
  </div>
</div>

<!-- Popup -->
<div class="popup" id="popupForm">
  <div class="popup-content">
    <h3 id="popupTitle"></h3>
    <form id="actionForm">
      <input type="number" id="amount" placeholder="Enter amount" required>
      <textarea id="details" placeholder="Additional details" required></textarea>
      <button type="submit">Submit</button>
      <button type="button" onclick="closePopup()">Cancel</button>
    </form>
  </div>
</div>

<script>
  let currentUser = JSON.parse(localStorage.getItem("currentUser"));
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let requests = JSON.parse(localStorage.getItem("requests")) || [];
  let settings = JSON.parse(localStorage.getItem("settings")) || {};

  // Load dashboard
  if (currentUser) {
    document.getElementById("username").innerText = currentUser.username;
    document.getElementById("userImage").src = currentUser.image || "https://via.placeholder.com/50";

    // Load balance
    let user = users.find(u => u.username === currentUser.username);
    if (user) {
      document.getElementById("balance").innerText = (user.currency || "$") + user.balance.toFixed(2);
    }

    // Suspended?
    if (user && user.suspended) {
      document.getElementById("suspendedBox").innerHTML = `<div class="suspended">⚠️ Account Suspended by Admin</div>`;
      document.getElementById("actionsBox").style.display = "none";
    }

    // Announcement
    if (settings.announcement) {
      document.getElementById("announcementBox").innerHTML = `<div class="announcement">${settings.announcement}</div>`;
    }

    // Theme color
    if (settings.color) {
      document.body.style.background = settings.color;
    }

    // Load history
    loadHistory(user.username);
  } else {
    alert("No user logged in");
    window.location.href = "login.html";
  }

  function loadHistory(username) {
    let user = users.find(u => u.username === username);
    let historyList = document.getElementById("historyList");
    historyList.innerHTML = "";
    if (user && user.history) {
      user.history.forEach(item => {
        let li = document.createElement("li");
        li.textContent = `${item.date} - ${item.type}: ${item.amount} (${item.details})`;
        historyList.appendChild(li);
      });
    }
  }

  // Popup handling
  let currentAction = "";
  function openPopup(action) {
    currentAction = action;
    document.getElementById("popupTitle").innerText = action === "withdraw" ? "Withdraw Request" :
                                                     action === "transfer" ? "International Transfer" :
                                                     "Loan Request";
    document.getElementById("popupForm").style.display = "flex";
  }

  function closePopup() {
    document.getElementById("popupForm").style.display = "none";
  }

  // Submit action
  document.getElementById("actionForm").onsubmit = function(e) {
    e.preventDefault();
    let amount = document.getElementById("amount").value;
    let details = document.getElementById("details").value;

    let request = {
      user: currentUser.username,
      type: currentAction,
      amount: parseFloat(amount),
      details,
      status: "pending",
      date: new Date().toLocaleString()
    };

    requests.push(request);
    localStorage.setItem("requests", JSON.stringify(requests));

    alert("Request submitted! Waiting for admin approval.");
    closePopup();
  };
</script>

</body>
</html>
