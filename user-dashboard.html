<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
    .header { background:#002868; color:white; padding:15px; text-align:center; }
    .container { padding:20px; }
    .card { background:white; padding:15px; margin-bottom:15px; border-radius:5px; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    .logout-btn { background:red; color:white; padding:10px; border:none; cursor:pointer; width:100%; }
    .locked { color:red; font-weight:bold; }
    table { width:100%; border-collapse: collapse; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#eee; }
  </style>
</head>
<body>
  <div class="header">
    <h2>Welcome, <span id="userName"></span></h2>
  </div>

  <div class="container">
    <div class="card">
      <h3>Account Balance</h3>
      <p id="balance">$0.00</p>
      <p id="accountStatus"></p>
    </div>

    <div class="card">
      <h3>Transaction History</h3>
      <table id="historyTable">
        <thead>
          <tr><th>Date</th><th>Type</th><th>Amount</th></tr>
        </thead>
        <tbody id="historyBody">
          <tr><td colspan="3">No transactions yet.</td></tr>
        </tbody>
      </table>
    </div>

    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

<script>
  // ✅ Load logged in user
  let email = sessionStorage.getItem("loggedInUser");
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let user = users.find(u => u.email === email);

  if(!user) {
    window.location.href = "login.html"; // redirect if not logged in
  }

  // Show user name + balance
  document.getElementById("userName").innerText = user.name;
  document.getElementById("balance").innerText = "$" + Number(user.balance).toLocaleString();

  // Account lock check
  if(user.locked) {
    document.getElementById("accountStatus").innerHTML = "<span class='locked'>⚠️ Your account is locked. Contact support.</span>";
  }

  // Load transaction history
  function loadHistory() {
    let tbody = document.getElementById("historyBody");
    tbody.innerHTML = "";
    if(!user.transactions || user.transactions.length === 0) {
      tbody.innerHTML = "<tr><td colspan='3'>No transactions yet.</td></tr>";
      return;
    }
    user.transactions.forEach(tx => {
      tbody.innerHTML += `<tr>
        <td>${tx.date}</td>
        <td>${tx.type}</td>
        <td>$${tx.amount}</td>
      </tr>`;
    });
  }
  loadHistory();

  // Logout function
  function logout() {
    sessionStorage.removeItem("loggedInUser");
    window.location.href = "login.html";
  }
</script>
</body>
</html>
