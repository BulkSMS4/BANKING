<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f8f8; }
    h2 { color: #d40000; }
    .card { background: white; padding: 15px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, textarea, select, button { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #d40000; color: white; border: none; cursor: pointer; }
    button:hover { background: #a60000; }
    .user-list { margin-top: 20px; }
    .user { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px; background: #fafafa; }
    .actions button { margin-right: 5px; }
    label { font-weight: bold; }
  </style>
</head>
<body>

  <h2>Admin Dashboard</h2>

  <!-- Global Settings -->
  <div class="card">
    <h3>Global Settings</h3>
    <label>Popup Message (announcement)</label>
    <textarea id="popupMessage" placeholder="Write a message to appear on all user dashboards"></textarea>

    <label>Dashboard Theme Color</label>
    <input type="color" id="themeColor" value="#d40000" />

    <button onclick="saveSettings()">Save Settings</button>
    <button onclick="clearMessage()">Remove Popup Message</button>
  </div>

  <!-- User Management -->
  <div class="card">
    <h3>Manage Users</h3>
    <div id="userList" class="user-list"></div>
  </div>

<script>
  // Load users
  function loadUsers() {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let html = "";
    users.forEach((user, index) => {
      html += `
        <div class="user">
          <p><b>Name:</b> ${user.fullName}</p>
          <p><b>Email:</b> ${user.email}</p>
          <p><b>Balance:</b> $${user.balance.toFixed(2)}</p>
          <div class="actions">
            <button onclick="creditUser(${index})">Credit</button>
            <button onclick="spendUser(${index})">Spend</button>
            <button onclick="cancelTransaction(${index})">Cancel Txn</button>
            <button onclick="lockUser(${index})">Lock Account</button>
            <button onclick="toggleSuspend(${index})">${user.suspended ? "Unsuspend" : "Suspend"}</button>
          </div>
        </div>
      `;
    });
    document.getElementById("userList").innerHTML = html;
  }

  // Credit user
  function creditUser(index) {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let amount = parseFloat(prompt("Enter amount to credit:"));
    if (!isNaN(amount)) {
      users[index].balance += amount;
      saveUsers(users);
    }
  }

  // Spend user funds
  function spendUser(index) {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let amount = parseFloat(prompt("Enter amount to spend:"));
    if (!isNaN(amount) && amount <= users[index].balance) {
      users[index].balance -= amount;
      saveUsers(users);
    }
  }

  // Cancel transaction (reset last action)
  function cancelTransaction(index) {
    alert("Feature: Cancel last transaction â€“ not yet implemented fully.");
  }

  // Lock account
  function lockUser(index) {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    users[index].locked = true;
    saveUsers(users);
  }

  // Suspend/Unsuspend user
  function toggleSuspend(index) {
    let users = JSON.parse(localStorage.getItem("users")) || [];
    users[index].suspended = !users[index].suspended;
    saveUsers(users);
  }

  // Save settings globally
  function saveSettings() {
    let settings = {
      message: document.getElementById("popupMessage").value,
      themeColor: document.getElementById("themeColor").value
    };
    localStorage.setItem("settings", JSON.stringify(settings));
    alert("Settings saved!");
  }

  function clearMessage() {
    let settings = JSON.parse(localStorage.getItem("settings")) || {};
    settings.message = "";
    localStorage.setItem("settings", JSON.stringify(settings));
    alert("Popup message cleared!");
  }

  function saveUsers(users) {
    localStorage.setItem("users", JSON.stringify(users));
    loadUsers();
  }

  // Load on start
  loadUsers();

  // Load settings if exist
  let settings = JSON.parse(localStorage.getItem("settings")) || {};
  if (settings.message) document.getElementById("popupMessage").value = settings.message;
  if (settings.themeColor) document.getElementById("themeColor").value = settings.themeColor;
</script>

</body>
</html>
